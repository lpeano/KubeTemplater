# golangci-lint configuration with security focus
# https://golangci-lint.run/usage/configuration/

run:
  timeout: 5m
  tests: true
  modules-download-mode: readonly

linters:
  enable:
    # Security linters
    - gosec          # Inspects source code for security problems
    - goconst        # Finds repeated strings that could be replaced by a constant
    - gocritic       # Provides diagnostics that check for bugs, performance and style issues
    - gocyclo        # Computes and checks the cyclomatic complexity of functions
    - revive         # Fast, configurable, extensible, flexible, and beautiful linter for Go
    - staticcheck    # Go vet on steroids
    - stylecheck     # Replacement for golint
    - unconvert      # Remove unnecessary type conversions
    - unparam        # Reports unused function parameters
    - unused         # Checks for unused constants, variables, functions and types
    
    # Error handling
    - errcheck       # Checks that you check errors
    - errorlint      # Find code that will cause problems with Go 1.13+ error wrapping
    
    # Code quality
    - gofmt          # Checks whether code was gofmt-ed
    - goimports      # Checks import statements are formatted according to the 'goimport' command
    - misspell       # Finds commonly misspelled English words
    - nakedret       # Finds naked returns in functions greater than a specified function length
    - prealloc       # Finds slice declarations that could potentially be preallocated
    
    # Performance
    - bodyclose      # Checks whether HTTP response body is closed successfully
    - noctx          # Finds sending http request without context.Context
    
  disable:
    - exhaustive     # Too noisy
    - exhaustruct    # Too strict
    - gci            # Conflicts with goimports
    - gofumpt        # Too opinionated
    - tagliatelle    # Too strict for Kubernetes APIs
    - varnamelen     # Too noisy
    - wrapcheck      # Too strict
    - nlreturn       # Too opinionated
    - wsl            # Too opinionable

linters-settings:
  gosec:
    severity: medium
    confidence: medium
    excludes:
      - G104  # Audit errors not checked (covered by errcheck)
    includes:
      - G101  # Look for hard coded credentials
      - G102  # Bind to all interfaces
      - G103  # Audit the use of unsafe block
      - G201  # SQL query construction using format string
      - G202  # SQL query construction using string concatenation
      - G203  # Use of unescaped data in HTML templates
      - G204  # Audit use of command execution
      - G301  # Poor file permissions used when creating a directory
      - G302  # Poor file permissions used with chmod
      - G303  # Creating tempfile using a predictable path
      - G304  # File path provided as taint input
      - G305  # File traversal when extracting zip/tar archive
      - G306  # Poor file permissions used when writing to a new file
      - G401  # Detect the usage of DES, RC4, MD5 or SHA1
      - G402  # Look for bad TLS connection settings
      - G403  # Ensure minimum RSA key length of 2048 bits
      - G404  # Insecure random number source (rand)
      - G501  # Import blocklist: crypto/md5
      - G502  # Import blocklist: crypto/des
      - G503  # Import blocklist: crypto/rc4
      - G504  # Import blocklist: net/http/cgi
      - G505  # Import blocklist: crypto/sha1
      - G601  # Implicit memory aliasing in for loop

  gocyclo:
    min-complexity: 15

  gocritic:
    enabled-tags:
      - diagnostic
      - experimental
      - opinionated
      - performance
      - style
    disabled-checks:
      - dupImport
      - ifElseChain
      - octalLiteral
      - whyNoLint

  revive:
    rules:
      - name: blank-imports
      - name: context-as-argument
      - name: context-keys-type
      - name: dot-imports
      - name: error-return
      - name: error-strings
      - name: error-naming
      - name: exported
      - name: if-return
      - name: increment-decrement
      - name: var-naming
      - name: var-declaration
      - name: package-comments
      - name: range
      - name: receiver-naming
      - name: time-naming
      - name: unexported-return
      - name: indent-error-flow
      - name: errorf
      - name: empty-block
      - name: superfluous-else
      - name: unused-parameter
      - name: unreachable-code
      - name: redefines-builtin-id

  errcheck:
    check-type-assertions: true
    check-blank: false

  staticcheck:
    checks: ["all"]

issues:
  exclude-use-default: false
  max-issues-per-linter: 0
  max-same-issues: 0
  
  exclude-rules:
    # Exclude some linters from running on tests files
    - path: _test\.go
      linters:
        - gocyclo
        - errcheck
        - gosec
        - goconst
        
    # Exclude known false positives
    - text: "weak cryptographic primitive"
      linters:
        - gosec
      path: _test\.go
    
    # Exclude G304 (file inclusion via variable) for config files
    - text: "G304: Potential file inclusion via variable"
      linters:
        - gosec
      path: cmd/main\.go
    
    # Allow dynamic errors in specific cases
    - text: "do not define dynamic errors, use wrapped static errors instead"
      linters:
        - goerr113
      path: internal/

output:
  formats:
    - format: colored-line-number
  print-issued-lines: true
  print-linter-name: true
  uniq-by-line: true
  sort-results: true
